title:  "Redis数据类型"
date: "2015-05-29"
categories: 
  - redis
tags:
    - redis
---

Redis数据类型主要分为五种类型

- string
- hash
- list
- set
- zset


### string类型

string类型是最简单的类型，一个key对应一个value，string类型是二进制安全的，redis的string可以包含任何数据，比如图片或者序列化的对象

> set：设置key对应的值为string类型的value，如果重复key，则后者会覆盖前者

```sh

127.0.0.1:6379> set name liuyiyou       #name=liuyiyou
OK


```

> get:通过key得到value

```sh

127.0.0.1:6379>  get name
"liuyiyou"

```

> setnx：设置key对应的值为string类型的value，如果key已经存在，返回0，更新不成功。nx是not exist的意思

```sh

127.0.0.1:6379> SETNX name liuyiyou
(integer) 0

```

> setex：设置key对应的值为string类型的value，并指定此键值对应的有效期


```sh

#添加一个  newname=liuyiyou 10秒超时
127.0.0.1:6379> SETNX name liuyiyou
(integer) 0
127.0.0.1:6379> SETEX  newname 10  liuyiyou
OK
127.0.0.1:6379> get newname
"liuyiyou"
127.0.0.1:6379> get newname
"liuyiyou"
127.0.0.1:6379> get newname
(nil)


```


> setrange：设置指定key的value值的子字符串，替换的长度默认为新字串的长度

```sh

127.0.0.1:6379> set lyy.email liuyiyou@163.com
OK
127.0.0.1:6379> get lyy.email
"liuyiyou@163.com"
127.0.0.1:6379> SETRANGE lyy.email 9 qq.com
(integer) 16
127.0.0.1:6379> GET lyy.email
"liuyiyou@qq.comm"   #最后一个m没有去掉

```

> mset：一次设置多个key的值

```sh


127.0.0.1:6379> MSET  key1 liu key2 yi key3 you
OK
127.0.0.1:6379> GET key1
"liu"
127.0.0.1:6379> GET key2
"yi"
127.0.0.1:6379> GET key3
"you"

```


> msetnx：一次设置多个key的值，成功返回OK表示所有的值都设置了，失败返回0表示没有任何值被设置，但是不会覆盖已经存在的key

```sh

127.0.0.1:6379> MSETNX  key4 test key3 yi
(integer) 0
127.0.0.1:6379> GET key4
(nil)
127.0.0.1:6379> GET key3
"you"

```

> getset：设置新值并返回旧值

```sh

127.0.0.1:6379> GETSET key3 newyou
"you"
127.0.0.1:6379> GET key3
"newyou"

```


> getrange  

```sh

127.0.0.1:6379> GETRANGE   lyy.email 0 14
"liuyiyou@qq.com"

```

> mget ：一次获取多个key的值，如果对应key不存在，则返回nil  

```sh

127.0.0.1:6379> MGET  key1 key2 key3 key4 key5
1) "liu"
2) "yi"
3) "newyou"
4) (nil)
5) (nil)

```


>  incr（递增）：对key的值做加操作，并返回新的值

```sh

127.0.0.1:6379> INCR  key6
(integer) 31
127.0.0.1:6379> INCR  key6
(integer) 32
127.0.0.1:6379> INCR  key6
(integer) 33
127.0.0.1:6379> get key7
(nil)
127.0.0.1:6379> INCR key7
(integer) 1
127.0.0.1:6379> INCR key7
(integer) 2

```


> incrby：痛incr类似，加指定值，key不存在的时候会设置key，并认为原来的value是0

```sh

127.0.0.1:6379> INCRBY key6 5
(integer) 38
127.0.0.1:6379> INCRBY key6 5
(integer) 43
127.0.0.1:6379> INCRBY key6 -5
(integer) 38
127.0.0.1:6379> INCRBY key6 -5
(integer) 33

```

>  decr、decrby和incr、incrby相反


> append：给指定的key的字符串追加value，返回新字符串的长度

```sh

127.0.0.1:6379> GET name
"liuyiyou"
127.0.0.1:6379> APPEND name @qq.com
(integer) 15
127.0.0.1:6379> GET name
"liuyiyou@qq.com"

```


> strlen：取指定key的value值的长度

```sh

127.0.0.1:6379> STRLEN  name
(integer) 15
127.0.0.1:6379>

```

###hash类型

Redis的hash是一个string类型的field和value的映射表，它的添加、删除操作平均都是O(1)。hash特别适合存储对象。相较于将对象的每个字段存成单个string类型。将一个对象存储在hash类型中会占用更少的内存，并且更加方便的存储整个对象

> hset：设置hash field指定值，如果key不存在，则先创建

```sh

127.0.0.1:6379> HSET myhash field1 Hello
(integer) 1
127.0.0.1:6379> HGET  user:001 name
"liuyiyou"
127.0.0.1:6

```


>  hsetnx：设置hash field为指定值，如果key不存在，则先创建，如果存在则返回0

```sh

127.0.0.1:6379> HSETNX user:002  name yiyou
(integer) 1
127.0.0.1:6379> HGET user:002 name
"yiyou"
127.0.0.1:6379> HSETNX user:002 name liuyiyou
(integer) 0
127.0.0.1:6379> HGET user:002 name
"yiyou"

```


> hmset：同时设置多个field

```sh

127.0.0.1:6379> HMSET user:003 name liuyiyou  age 20 sex 1
OK
127.0.0.1:6379> HGET user:003 name
"liuyiyou"
127.0.0.1:6379> HGET user:003 age
"20"
127.0.0.1:6379> HGET user:003 sex
"1"

```


> hmget：获取全部指定的hash field

```sh

127.0.0.1:6379> HMGET user:003  name age sex
1) "liuyiyou"
2) "20"
3) "1"

```


> hincrby：指定的hash field加上给定值，返回新值

```sh

127.0.0.1:6379> HINCRBY user:003 name 8
(error) ERR hash value is not an integer
127.0.0.1:6379> HINCRBY user:003 age -8
(integer) 20


```


> hexists：测试指定field是否存在，存在返回1，不存在返回0

```sh

127.0.0.1:6379> HEXISTS user:003 name
(integer) 1
127.0.0.1:6379> HEXISTS user:003 address
(integer) 0

```

> hlen：返回指定hash的field的数量

```sh

127.0.0.1:6379> HLEN user:001
(integer) 1
127.0.0.1:6379> HLEN user:003
(integer) 3

```


> hdel：删除指定hash的field

```sh

127.0.0.1:6379> HDEL user:003 age
(integer) 1
127.0.0.1:6379> HGET user:003 age
(nil)

```

> hkeys：返回hash的所有field

```sh

127.0.0.1:6379> HKEYS user:001
1) "name"
127.0.0.1:6379> HKEYS user:002
1) "name"
127.0.0.1:6379> HKEYS user:003
1) "name"
2) "sex"

```

> hvals：返回hash的所有value

```sh

127.0.0.1:6379> HVALS user:001
1) "liuyiyou"
127.0.0.1:6379> HVALS user:003
1) "liuyiyou"
2) "1"


```


> hgetall：获取某个hash中全部的field和value

```sh

1) "name"
2) "liuyiyou"
127.0.0.1:6379> HGETALL user:003
1) "name"
2) "liuyiyou"
3) "sex"
4) "1"

```



###list类型

###set类型

set是集合，它是string类型的无序集合。set通过hash table实现的，添加和删除和查找的复杂度都是O(1)。对集合我们可以取并集、交集、差集。通过这些操作我们可以实现sns中的好友推荐和blog的tag功能。

> sadd：向名称为key的set中添加元素

```sh

127.0.0.1:6379> SADD myset1 one
(integer) 1
127.0.0.1:6379> SADD myset1 two
(integer) 1
127.0.0.1:6379> SADD myset1 two
(integer) 0

```

> smembers：查看集合中的元素

```sh

127.0.0.1:6379> SMEMBERS myset1
1) "one"
2) "two"

```

> srem：删除名称为key的set中的元素

```sh

127.0.0.1:6379> SREM myset1 one
(integer) 1
127.0.0.1:6379> SMEMBERS myset1
1) "two"
127.0.0.1:6379> SREM myset two
(integer) 0
127.0.0.1:6379> SREM myset1 two
(integer) 1
127.0.0.1:6379> SMEMBERS myset1
(empty list or set)

```

> spop：随机返回并删除名称为key的set中的一个元素

```sh

127.0.0.1:6379> SMEMBERS myset3
1) "four"
2) "three"
3) "one"
4) "two"
5) "five"
127.0.0.1:6379> SPOP myset3
"three"
127.0.0.1:6379> SPOP myset3
"one"
127.0.0.1:6379> SPOP myset3
"four"
127.0.0.1:6379> SPOP myset3
"five"
127.0.0.1:6379> SPOP myset3
"two"
127.0.0.1:6379> SPOP myset3
(nil)


```


> sdiff：返回所有给定key与第一个key的差集，谁在前面，谁就是标准

```sh

127.0.0.1:6379> SMEMBERS myset1
1) "one"
2) "two"
127.0.0.1:6379> SMEMBERS myset3
(empty list or set)
127.0.0.1:6379> SDIFF myset1 myset3
1) "one"
2) "two"
127.0.0.1:6379> SDIFF myset3 myset1
(empty list or set)

```

> sdiffstore：返回所有给定key与第一个key的差集，并将结果存为另一个key



```sh

#sdiffstore  需要存储的值     集合1   集合2

```

> sunion  返回所有给定key的并集


```sh

#sunion myset1 myset2

```


> sunionstore：返回所有给定key的并集并存储到新的key中

```sh

#sunionstore  新的key   需要的并集1  需要的并集2

```

> smove：从第一个key对应的set中移除member并添加到第二个对应的set中

```sh

127.0.0.1:6379> SMEMBERS myset2
1) "one"
2) "two"
127.0.0.1:6379> SMEMBERS myset3
1) "one"
2) "two"
127.0.0.1:6379> SADD myset3 three
(integer) 1
127.0.0.1:6379> SMEMBERS myset2
1) "one"
2) "two"
127.0.0.1:6379> SMEMBERS myset3
1) "three"
2) "one"
3) "two"
127.0.0.1:6379> SMOVE myset3 myset2 three
(integer) 1
127.0.0.1:6379> SMEMBERS myset2
1) "three"
2) "one"
3) "two"
127.0.0.1:6379> SMEMBERS myset3
1) "one"
2) "two"

```

> scard：返回名称为key的set的元素个数

```sh

127.0.0.1:6379> SCARD myset3
(integer) 2
127.0.0.1:6379> SCARD myset1
(integer) 0

```

> sismember：测试member是否是名称为key的元素

```sh

127.0.0.1:6379> SMEMBERS myset3
1) "one"
2) "two"
127.0.0.1:6379> SISMEMBER myset3 two
(integer) 1
127.0.0.1:6379> SISMEMBER myset3 three
(integer) 0

```

> srandmember：随机返回名称为key的set的一个元素，但不删除元素

```sh

127.0.0.1:6379> SRANDMEMBER myset
(nil)
127.0.0.1:6379> SRANDMEMBER myset3
"two"
127.0.0.1:6379> SRANDMEMBER myset3
"two"
127.0.0.1:6379> SRANDMEMBER myset3
"one"

```


###zset

sorted set是set的一个升级版本，它在set的基础上增加了一个顺序属性，这一属性在添加、修改、元素的时候可以指定，每次指定后，zset会自动重新按新的值调整顺序。可以理解为友两列的mysql表，一列存储value，一列存储顺序。操作中key理解为zset的名字

> zadd：加入新元素，如果加入的元素和顺序都已经存在，则加入失败，如果顺序不同，则更新为新的顺序

```sh

127.0.0.1:6379> ZADD zset1 1 one
(integer) 1
127.0.0.1:6379> ZADD zset1 1 one
(integer) 0
127.0.0.1:6379> ZADD zset1 2 two
(integer) 1
127.0.0.1:6379> ZADD zset1 3 three
(integer) 1

```

> zrange：去的zset中集合的元素，如果加上withscores则还取出元素的序列号

```sh

127.0.0.1:6379> ZRANGE  zset1 0 -1 withscores
1) "one"
2) "1"
3) "two"
4) "2"
5) "three"
6) "3"

```


> zrem：删除名称为key的zset中的元素member

```sh

127.0.0.1:6379> ZRANGE  zset1 0 -1 withscores
1) "one"
2) "1"
3) "two"
4) "2"
5) "three"
6) "3"
127.0.0.1:6379> ZREM zset1 three
(integer) 1
127.0.0.1:6379> ZRANGE  zset1 0 -1 withscores
1) "one"
2) "1"
3) "two"
4) "2"

```

> zincrby：如果在名称为key的zset中已经存在元素member，则该元素的score增加increment，否则向该集合中添加该元素，其score的值为increment

```sh

127.0.0.1:6379> ZRANGE  zset1 0 -1 withscores
1) "one"
2) "1"
3) "two"
4) "2"
127.0.0.1:6379> ZINCRBY zset1 4  one 
"5"
127.0.0.1:6379> ZRANGE zset1 0 -1 withscores
1) "two"
2) "2"
3) "one"
4) "5"

```

> zrank 返回名称为key的zset中member元素的排名（按score从小到大排序）即下标

```sh

127.0.0.1:6379> ZRANGE zset1 0 -1 withscores
1) "one"
2) "1"
3) "two"
4) "2"
127.0.0.1:6379> zadd zset1 3 three
(integer) 1
127.0.0.1:6379> ZRANK zset1 two
(integer) 1

```

> zrevrank：返回名称为key的zset中的member元素排名（按score从小到大排序）即下标

```sh

```

> zrangebyscore：返回集合中score在给定区间的元素

```sh

127.0.0.1:6379> ZRANGE zset1 0 -1 withscores
1) "one"
2) "1"
3) "two"
4) "2"
5) "three"
6) "3"
127.0.0.1:6379> ZRANGEBYSCORE zset1 2 3 withscores
1) "two"
2) "2"
3) "three"
4) "3"

```

>  zcount：返回集合中score在给定区间的元素

```sh

127.0.0.1:6379> ZRANGEBYSCORE zset1 2 3 withscores
1) "two"
2) "2"
3) "three"
4) "3"
127.0.0.1:6379> ZCOUNT zset 2 3 
(integer) 0
127.0.0.1:6379> ZCOUNT zset1 2 3 
(integer) 2

```

> zremrangebyrank：删除集合中排名在给定区间的元素

```sh

```

> 

```sh

```

