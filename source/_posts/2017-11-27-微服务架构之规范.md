title: 微服务架构之规范
date: 2017-11-27
categories : 
  - spring-boot
tags : 
  - spring-boot
---


## 说明

在传统开发模式下的单应用架构，一般会将model层和dao层划分为一层（打包成jar）。之上是服务层（打包成jar），再之上是web层

好处：开发快速，简单
坏处：只能单机部署，业务复杂后性能低下

在分布式服务的开发环境下，和单应用类似，区别在于，会将service接口和service实现打成两个包，对外提供服务的包括接口service，model以及相关类，客户端依赖service-api，且客户端一般是web层或者业务层

好处：能部署多台机器
坏处：业务升级、服务接口修改时需要各个项目进行配合

在微服务架构下，则是两者的综合。
      和单应用相比：微服务是一个单独的应用，从model层到web层都在一个应用内，不同的是，微服务也对外提供暴露服务，而且可以分布式部署
      和分布式服务相比：有自己的web层，可以直接对外提供REST接口，同时提供服务API，供其他服务调用
好处：开发快速、简单、能实现分布式
坏处：模块太多，维护麻烦


## 目的

对整个项目作出统一规范，减少各个开发人员沟通成本


## 项目规范


### 微服务

### Spring-Boot版本

统一选择使用1.5.8.RELEASE

### Spring-Cloud版本

统一选择使用 Edgware.RELEASE

### 部署方式

统一使用jar方式，后续可能会引入Docker

### 端口号

由运维统一指定

### 部署个数

暂定两个，后续重要服务可能会有多个

#### 项目命名

- 基础微服务统一以xxx-server进行命名
- 业务微服务统一以xxx-business进行命名

服务以订单服务为例

- 项目名称：product-server
- groupId: com.iba.server
- artifactId: com.iba.sever.product


只提供商品相关的增删改成，基本不包含业务逻辑
业务以商品服务为例
项目名称：product-business
groupId: com.iba.business



#### 包目录结构

##### 服务方


如图所示：

![微服务包图](/images/service-product.png)

业务服务和其他服务需要调用的时候

1、添加依赖

```xml
<dependency>
 <groupId>com.iba.server</groupId>
 <artifactId>product-server-contract</artifactId>
 <version>0.0.1-SNAPSHOT</version>
</dependency>
```

2、增加注解

```java
@SpringBootApplication
@EnableDiscoveryClient
@EnableFeignClients(basePackages = {"com.iba.service.*.contract"})
public class StoreServerApplication {

   public static void main(String[] args) {
      SpringApplication.run(StoreServerApplication.class, args);
 }
}

```


3、调用服务

```java
@RestController
public class StoreController {

    private Logger logger = LoggerFactory.getLogger(StoreController.class);

 @Autowired
 private IProductService productService;


 @RequestMapping("getStore")
    public void getStore() {
        logger.info("调用本地服务");
 productService.listUser();
 logger.info("调用其他服务提供的服务");
 }

}

```


1. MyBatis列表查询，如果没有数据，不会返回null，而是返回一个空集合，所以，不需要在上层使用

2. 数据库所有字段都要有默认值，否则查询对象后得到get某个字段的时候可能会产生NPE

3. 自定义方法的时候，注意不返回NULL

4. 使用Optional来避免NPE