title: DBUtils使用
date: 2014-09-10
categories:
  - tools
tags :
  - java
---


```xml
<!-- 一个sql语法检查 https://mvnrepository.com/artifact/net.sf.jsqlparser/jsqlparser -->
<dependency>
    <groupId>net.sf.jsqlparser</groupId>
    <artifactId>jsqlparser</artifactId>
    <version>0.8.0</version>
</dependency>

```


更多详细内容参考：http://www.cnblogs.com/myit/tag/dbutils/

```java

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;
import java.util.Map;

import javax.sql.DataSource;

import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.ResultSetHandler;
import org.apache.commons.dbutils.handlers.MapHandler;
import org.apache.commons.dbutils.handlers.MapListHandler;
import org.junit.Test;
import org.springframework.beans.BeanUtils;
import org.springframework.jdbc.datasource.SimpleDriverDataSource;

import com.google.common.collect.Lists;
import com.google.common.collect.Maps;

/**
 * @author liuyiyou.cn
 * @date 2014年09月19日 上午9:59:13
 * @version
 */
public class DBUtilsTest {

    static final String DRIVER = "com.mysql.jdbc.Driver";

    static final String URL = "jdbc:mysql://127.0.0.1:3306/test";

    /**
     * <code>Enumeration<Driver> drivers = DriverManager.getDrivers();
        if (drivers.hasMoreElements()) {
            System.out.println(drivers.nextElement().getClass());
        }
        DataSource dataSourceTmp = new SimpleDriverDataSource(DriverManager.getDriver(DRIVER), URL, "root","123456");</code>
     *
     * @throws SQLException
     */
    @Test
    public void getTableNames() throws SQLException {
        DataSource dataSource = new SimpleDriverDataSource(BeanUtils.instantiateClass(com.mysql.jdbc.Driver.class), URL,
                "root", "123456");
        QueryRunner query = new QueryRunner(dataSource);
        List<String> tablesNames = query.query("show tables", new ResultSetHandler<List<String>>() {
            List<String> tables = Lists.newArrayList();

            @Override
            public List<String> handle(ResultSet rs) throws SQLException {
                while (rs.next()) {
                    tables.add(rs.getString(1));
                }
                return tables;
            }
        });
        for (String name : tablesNames) {
            System.out.println(name);
        }
    }

    @Test
    public void getColumns() throws SQLException {
        DataSource dataSource = new SimpleDriverDataSource(BeanUtils.instantiateClass(com.mysql.jdbc.Driver.class), URL,
                "root", "123456");
        QueryRunner query = new QueryRunner(dataSource);
        List<String> tablesNames = query.query(
                "select column_name,column_comment from information_schema.columns where table_schema = 'test' and table_name = 'ds_worker_base_info'; ",
                new ResultSetHandler<List<String>>() {
                    List<String> tables = Lists.newArrayList();

                    @Override
                    public List<String> handle(ResultSet rs) throws SQLException {
                        while (rs.next()) {
                            tables.add(rs.getString(1) + "\t" + rs.getString(2));
                        }
                        return tables;
                    }
                });
        for (String name : tablesNames) {
            System.out.println(name);
        }
    }

    @Test
    public void testInsert() throws SQLException {
        DataSource dataSource = new SimpleDriverDataSource(BeanUtils.instantiateClass(com.mysql.jdbc.Driver.class), URL,
                "root", "123456");
        String tableName = "t_score_def";
        QueryRunner query = new QueryRunner(dataSource);
        Map<String, String> columnMap = query.query(
                "select column_name,column_comment from information_schema.columns where "
                        + "table_schema = 'test' and table_name = '" + tableName + "'; ",
                new ResultSetHandler<Map<String, String>>() {
                    Map<String, String> columnMap = Maps.newLinkedHashMap();

                    @Override
                    public Map<String, String> handle(ResultSet rs) throws SQLException {
                        while (rs.next()) {
                            columnMap.put(rs.getString(1), rs.getString(2));
                        }
                        return columnMap;
                    }
                });
        StringBuilder sb = new StringBuilder(512);
        sb.append("INSERT INTO ").append(tableName).append(" VALUES( ");
        String split = "";
        for (String key : columnMap.keySet()) {
            sb.append(split);
            split = ",";
            sb.append(key);
        }
        // sb.setLength(sb.length()-1);
        // sb.deleteCharAt(sb.length()-1);
        sb.append(" )");
        System.out.println(sb.toString());
    }

    @Test
    public void listTest() {
        StringBuilder sb = new StringBuilder(512);
        List<String> list = Lists.newArrayList("a", "b", "c", "d", "e", "f");
        for (String s : list) {
            sb.append(s).append(",");
        }
        System.out.println(sb.toString());
    }

    @Test
    public void selectTest() throws SQLException {
        DataSource dataSource = new SimpleDriverDataSource(BeanUtils.instantiateClass(com.mysql.jdbc.Driver.class), URL,
                "root", "123456");
        String sql = "select * from ds_worker_base_info limit 200;";
        QueryRunner query = new QueryRunner(dataSource);

        List<Map<String, Object>> rs = query.query(sql, new MapListHandler());
        // List<Object[]> rs = query.query(sql, new ArrayListHandler());
        List<String[]> list = Lists.newArrayList();

        for (Map<String, Object> map : rs) {

            Object[] array = map.values().toArray();
            String[] line = new String[array.length];
            for (int i = 0; i < array.length; i++) {
                line[i] = array[i].toString();
            }
            list.add(line);
        }
        for (String[] value : list) {
            System.out.println(value);
        }

    }

    @Test
    public void getSingleRowTest() throws SQLException {
        DataSource dataSource = new SimpleDriverDataSource(BeanUtils.instantiateClass(com.mysql.jdbc.Driver.class), URL,
                "root", "123456");
        String sql = "select * from ds_worker_base_info limit 200;";
        QueryRunner query = new QueryRunner(dataSource);
        Map<String, Object> rs = query.query(sql, new MapHandler());
        System.out.println(rs);

    }
}
```
