title: 2015-05-17总结
date: 2015-05-17
categories : 
  - 总结
tags : 
  - 总结
---

## 本周总结

1. 熟悉了一下Linux命令，一些常用的命令再也不需要每次用到的时候去查资料了。主要有下面的

```sh

mkdir  
pwd
rm -rf  file/direct
jar -xvf  project.war
unzip -xvf project.war
mv  project  project1
tail -n2000 -f  jboss.log 
scp 192.168.1.2/data/jboss 192.169.1.3/data/jboss
ps -ef|grep jboss

```


2. springmvc的json日期格式后台返回

如果数据库类型为timestap，则默认情况下，返回到前台是long类型，在非Ajax的情况下，可以使用jstl标签库或者velocity的一些工具函数，但是直接返回json的时候，这些都不行。如何办呢？

可以使用 @JsonFormat试一下

```java

/**
 * 解决SpringMVC使用@ResponseBody返回json时，日期格式默认显示为时间戳的问题。需配合<mvc:message-converters>使用
 * 
 */
@Component("customObjectMapper")
public class CustomObjectMapper extends ObjectMapper {

	public CustomObjectMapper() {
		CustomSerializerFactory factory = new CustomSerializerFactory();
		factory.addGenericMapping(Date.class, new JsonSerializer<Date>() {
			@Override
			public void serialize(Date value, JsonGenerator jsonGenerator,
					SerializerProvider provider) throws IOException, JsonProcessingException {
				SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
				jsonGenerator.writeString(sdf.format(value));
			}
		});
		this.setSerializerFactory(factory);
	}
}

```

然后在**dispatch-servlet.xml**中配置

```xml

 <mvc:annotation-driven>
 	<mvc:message-converters>
 		<bean class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter">
 			<property name="objectMapper" ref="customObjectMapper"></property>
 		</bean>
 	</mvc:message-converters>
 </mvc:annotation-driven>

```

当然还有其他方法，到时候总结一下

## 里面有几个坑

1. jboss 

以前没用过，只用过tomcat，只要把war包放到deploy文件夹下就行，不过和tomcat不同的是，tomcat会自动解压，解压后的文件夹名称为原有名称去掉.war后缀。而他不会自动解压，而是直接以war包运行。看公司其他运行的项目都是已projectName.war（不是war包，而是一个文件夹的名称）运行，为啥不直接叫projectName呢？
于是在部署的时候，和运维的同事说，先解压再启动吧，这样以后局部跟新的时候比较好替换，于是理所当然的解压为项目名称，结果虽然能正常启动，但是访问路径的时候报404错误。 直到重命名为为项目吗.war之后，才能正确运行

所用版本为jboss.4.2.3.GA版本。貌似很低很低的版本

2. jQuery多次绑定问题

项目里面涉及到一个评论，每个评论都有点赞功能和删除功能。
刚开始赶时间，发布评论的时候也没会刷新，然后将作品评论全部加载出来，只查询一次数据库，不过体验不好，因为该也没有视频，不能在看视频的发布评论
评论改为Ajax提交，不刷新也没，但是评论列表不能展现最新的评论，所以想到直接在已有评论列表中直接插入，不过里面涉及到了点赞和删除。为了偷懒，在点赞的时候只返回一个状态码，增加是直接通过js加上去的。这样处理有两个问题

1. js绑定

假设点赞html是这样的

```html

<li  class="upvoteAdd"   >点赞(<span id="voteupNum_1" )0</span></li>

```

上面的li是增加成功后在前台拼接而成的，然后我在js中这样写：

```js

 <script>
        $(".upvoteAdd").click(function(){
                 //拿到现在的然后+1  偷懒的方法 
       });
 </script>

```

结果就是点赞不起作用，原因是js执行流程是按照先后顺序的。所以新增的li是没有绑定click事件的，所以该js代码必须写在增加评论成功后，比如这样

```js

$.getJSON('/path/to/file', {
	param1: 'value1'
}, function(json, textStatus) {
	if (json.suucess) {
		//在这里进行绑定
		$(".upvoteAdd").click(function() {
			//拿到现在的然后+1  偷懒的方法 
		});
	}
});	

```

这样，点赞才能起作用，不过这样还会有一个问题，连续发三次评论，然后分别点赞，第三次显示1，第二次显示2，第一次显示3.原因是因为第二次增加评论的时候，第一次发布的评论又绑定了两次，第三次发布的时候第二个评论绑定了两次，第一次发布的绑定了三次。

解决办法：很多种
